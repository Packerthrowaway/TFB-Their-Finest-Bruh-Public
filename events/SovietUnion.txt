###########################
# Soviet Events
###########################

add_namespace = soviet

# VERY IMPORTANT, SETS BARB FLAG
country_event = {
	id = NSB_soviet_five_year_plan.01
	title = NSB_soviet_five_year_plan.01.t
	desc = NSB_soviet_five_year_plan.01.desc
	picture = GFX_report_event_stalin_01
	
	is_triggered_only = yes

	fire_only_once = yes

	option = { #VAYA POR DIOS
		name = NSB_soviet_five_year_plan.01.a
		
		custom_effect_tooltip = NSB_soviet_five_year_plan_tt
		
		hidden_effect = {
			set_country_flag = SOV_great_patriotic_war_start
			mark_focus_tree_layout_dirty = yes
		}
	}
}


# Second 5 Year Plan Completed
country_event = {
	id = soviet.600
	title = soviet.600.t
	desc = soviet.600.d
	picture = GFX_report_event_tank_factory
	fire_only_once = yes
	
	is_triggered_only = yes
	
	option = {
		name = soviet.600.a
		ai_chance = { factor = 100 }
		
		add_political_power = 75
		add_stability = 0.1
		
		custom_effect_tooltip = SOV_generic_modify_command_economy_tt
		custom_effect_tooltip = SOV_construction_speed_mil_10_tt
		add_to_variable = { SOV_command_economy_production_speed_arms_factory_factor_var = 0.1 }
		custom_effect_tooltip = SOV_construction_speed_civ_-20_tt
		add_to_variable = { SOV_command_economy_production_speed_industrial_complex_factor_var = -0.2 }
	}
}

# Third 5 year plan completed
country_event = {
	id = soviet.699
	title = soviet.699.t
	desc = soviet.699.d
	picture = GFX_report_event_stalin_propaganda
	fire_only_once = yes
	
	is_triggered_only = yes
	
	option = {
		name = soviet.699.a
		ai_chance = { factor = 100 }
		
		add_political_power = 75
		add_stability = 0.1
		add_war_support = 0.15
		custom_effect_tooltip = SOV_generic_modify_command_economy_tt
		custom_effect_tooltip = SOV_factory_output_5_tt
		add_to_variable = { SOV_command_economy_industrial_capacity_factory_var = 0.05 }
		custom_effect_tooltip = SOV_efficiency_cap_5_tt
		add_to_variable = { SOV_command_economy_production_factory_max_efficiency_factor_var = 0.05 }

		hidden_effect = {
			set_country_flag = SOV_third_5_year_plan_completed
		}
	}
}

# Stalin demands Tonk
country_event = {
	id = soviet.610
	title = soviet.610.t
	desc = soviet.610.d
	picture = GFX_report_event_SOV_tank_column
	fire_only_once = yes
	
	trigger = {
		tag = SOV
		threat > 0.14
	}
	
	option = {
		name = soviet.610.a
		ai_chance = { factor = 100 }

		custom_effect_tooltip = SOV_stalin_demands_tanks_tt
				
		hidden_effect = {
			set_country_flag = SOV_stalin_demands_tanks_flag
		}
	}
}

# Stalin demands Plane
country_event = {
	id = soviet.611
	title = soviet.611.t
	desc = soviet.611.d
	picture = GFX_report_event_SOV_purge_aircraft_2
	fire_only_once = yes
	
	trigger = {
		tag = SOV
		threat > 0.24
	}
	
	option = {
		name = soviet.611.a
		ai_chance = { factor = 100 }

		custom_effect_tooltip = SOV_stalin_demands_planes_tt
				
		hidden_effect = {
			set_country_flag = SOV_stalin_demands_planes_flag
		}
	}
}

# Stalin demands Ship
country_event = {
	id = soviet.612
	title = soviet.612.t
	desc = soviet.612.d
	picture = GFX_report_event_usa_heavy_cruiser
	fire_only_once = yes
	
	trigger = {
		tag = SOV
		threat > 0.04
	}
	
	option = {
		name = soviet.612.a
		ai_chance = { factor = 100 }

		custom_effect_tooltip = SOV_stalin_demands_ships_tt
				
		hidden_effect = {
			set_country_flag = SOV_stalin_demands_ship_flag
		}
	}
}

# Border Skirmish with the Japanese
country_event = {
	id = soviet.1
	title = soviet.1.t
	desc = soviet.1.d
	picture = GFX_report_event_japanese_transport_soldiers
	
	is_triggered_only = yes
	
	option = { # Push back
		name = soviet.1.a
		ai_chance = { factor = 75 }
		add_political_power = -25
		hidden_effect = {
			random_list = {
				60 = {
					JAP = {
						country_event = { days = 1 id = japan.3 }
					}
				}
				40 = {
					JAP = {
						country_event = { days = 1 id = japan.4 }
					}
				}
			}
		}
		effect_tooltip = {
			random_list = {
				60 = {
					country_event = soviet.2
				}
				40 = {
					country_event = soviet.3
				}
			}
		}
	}
	option = { # Yield
		name = soviet.1.b
		ai_chance = { factor = 25 }
		JAP = {
			effect_tooltip = {
				add_stability = 0.05
			}
			country_event = { days = 1 id = japan.5 }
		}
	}
}

# Successful Raid
country_event = {
	id = soviet.2
	title = soviet.2.t
	desc = soviet.2.d
	picture = GFX_report_event_dead_soldiers
	
	is_triggered_only = yes
	
	option = {
		name = soviet.2.a
		if = {
			limit = {
				561 = { 
					is_owned_by = SOV 
					any_neighbor_state = { 
						OR = {
							is_owned_by = JAP							
							is_owned_by = MAN								
						}
					} 
				}
			}
			561 = { add_manpower = -30000 }
		}		
		if = {
			limit = { 
				NOT = { 
					561 = { 
						is_owned_by = SOV 
						any_neighbor_state = { 
							OR = {
								is_owned_by = JAP
								is_owned_by = MAN
							} 	
						}
					}
				}
			}
			random_owned_state = {
				limit = { 
					any_neighbor_state = { 
						OR = {
							is_owned_by = JAP
							is_owned_by = MAN
						}
					} 
				} 
				add_manpower = -30000
			}
		}

		army_experience = 10
	}
}

# Failed Raid
country_event = {
	id = soviet.3
	title = soviet.3.t
	desc = soviet.3.d
	picture = GFX_report_event_dead_soldiers
	
	is_triggered_only = yes
	
	option = {
		if = {
			limit = {
				561 = { 
					is_owned_by = SOV 
					any_neighbor_state = { 
						OR = {
							is_owned_by = JAP
							is_owned_by = MAN							
						} 
					} 
				}
			}
			561 = { add_manpower = -20000 }
		}		
		if = {
			limit = { 
				NOT = { 
					561 = { 
						is_owned_by = SOV 
						any_neighbor_state = { 
							OR = {
								is_owned_by = JAP
								is_owned_by = MAN
							}
						}
					}
				}
			}
			random_owned_state = {
				limit = { 
					any_neighbor_state = { 
						OR = {
							is_owned_by = JAP
							is_owned_by = MAN
						}
					} 
				}
				add_manpower = -20000
			}
		}

		add_political_power = -25
		army_experience = 5
		name = soviet.3.a
	}
}

# Romania surrenders Bessarabia
country_event = {
	id = soviet.4
	title = soviet.4.t
	desc = soviet.4.d
	picture = GFX_report_event_soviet_army_greeted
	
	is_triggered_only = yes
	
	option = {
		name = soviet.4.a

		set_variable = { SOV.former_controller_of_bessarabia = 78.controller }
		
		ROOT = { #Scoping for tooltip reasons
			if = { #NSB note: Now this will check for ownership and control so that in edge cases where there might be more than one controller, it won't break.
				limit = {
					78 = { is_owned_and_controlled_by = FROM }
				}
				transfer_state = 78
			}
			if = {
				limit = {
					80 = { is_owned_and_controlled_by = FROM }
				}
				transfer_state = 80
			}
			if = {
				limit = {
					766 = { is_owned_and_controlled_by = FROM }
				}
				transfer_state = 766
			}
		}
		hidden_effect = {
			SOV = {
				country_event = { days = 1 id = news.10 }
			}
			news_event = { id = news.199 }
		}
	}
}

# Romania refuses to surrender Bessarabia
country_event = {
	id = soviet.5
	title = soviet.5.t
	desc = soviet.5.d
	picture = GFX_report_event_stalin_02
	
	is_triggered_only = yes
	
	option = {
		name = soviet.5.a
		create_wargoal = {
			type = take_state
			target = FROM
			generator = { 78 }
		}
		hidden_effect = {
			SOV = {
				country_event = { days = 1 id = news.11 }
			}
		}
	}
}

# Finland Accepts Demands
country_event = {
	id = soviet.12
	title = soviet.12.t
	desc = soviet.12.d
	picture = GFX_report_event_soviet_finnish_pact
	
	is_triggered_only = yes
	
	option = {
		name = soviet.12.a
		SOV = { 
			transfer_state = 146
			custom_effect_tooltip = FIN_remove_soviet_claims_in_other_states_tt
		}
		hidden_effect = {
			FIN = {
				every_core_state = {
					limit = {
						is_owned_by = PREV
						is_claimed_by = ROOT
					}
					remove_claim_by = ROOT 
				} 
			}
			SOV = {
				country_event = { days = 1 id = news.13 }
			}
		}
	}
}

# Finland Refuses Demands
country_event = {
	id = soviet.13
	title = soviet.13.t
	desc = soviet.13.d
	picture = GFX_report_event_soviet_tanks_snow
	
	is_triggered_only = yes
	
	option = {
		name = soviet.13.a
		create_wargoal = {
			type = take_state
			target = FIN
			generator = { 146 }
		}				
		hidden_effect = {
			SOV = {
				country_event = { days = 1 id = news.12 }
			}
		}
	}
}

# Xi'an Incident
country_event = {
	id = soviet.18
	title = soviet.18.t
	desc = soviet.18.d
	picture = GFX_report_event_china_politicians_captured
	
	trigger = {
		date > 1936.11.1
		tag = CHI
		has_opinion_modifier = hostile_status
		NOT = { has_dlc = "Waking the Tiger" }
	}

	fire_only_once = yes

	mean_time_to_happen = {
		days = 50
	}
	
	# Enter negotiations with Communist China
	option = {
		name = soviet.18.a
		PRC = { country_event = { id = soviet.19 days = 1 } }
	}

	# Refuse to negotiate
	option = {
		name = soviet.18.b
		#SOV = { country_event = { id = soviet.20 days = 1 } }
		ai_chance = { factor = 0 }
		set_global_flag = CHI_no_national_front_flag
		custom_effect_tooltip = CHI_no_united_front
	}
}

# Xi'an Incident - Communist China
country_event = {
	id = soviet.19
	title = soviet.19.t
	desc = soviet.19.d
	picture = GFX_report_event_japanese_chinese_surrender
	
	is_triggered_only = yes
	
	# Agree to a truce
	option = {
		name = soviet.19.a
		remove_opinion_modifier = { target = CHI modifier = hostile_status }
		CHI = {
			remove_opinion_modifier = { target = PRC modifier = hostile_status }
			country_event = { id = soviet.21 days = 1 }
		}
		hidden_effect = {
			605 = {
				if = {
					limit = { is_border_conflict = yes }
					set_border_war = no
				}
			}
			620 = {
				if = {
					limit = { is_border_conflict = yes }
					set_border_war = no
				}
			}
			607 = {
				if = {
					limit = { is_border_conflict = yes }
					set_border_war = no
				}
			}
			622 = {
				if = {
					limit = { is_border_conflict = yes }
					set_border_war = no
				}
			}
		}
		#SOV = { country_event = { id = soviet.21 days = 1 } }
	}

	# Refuse to negotiate
	option = {
		name = soviet.19.b
		SOV = { country_event = { id = soviet.22 days = 1 } }
		set_global_flag = CHI_no_national_front_flag
		ai_chance = { factor = 0 }
		custom_effect_tooltip = CHI_no_united_front
	}
}

# Xi'an Incident - Kuomintang Refuses
country_event = {
	id = soviet.20
	title = soviet.20.t
	desc = soviet.20.d
	picture = GFX_report_event_nationalist_china_machinegun_firing
	
	is_triggered_only = yes
	
	option = {
		name = soviet.20.a
	}
}

# Xi'an Incident - Truce
country_event = {
	id = soviet.21
	title = soviet.21.t
	desc = soviet.21.d
	picture = GFX_report_event_chinese_japanese_handshake
	
	is_triggered_only = yes
	
	option = {
		name = soviet.21.a
		effect_tooltip = {
			PRC = { remove_opinion_modifier = { target = CHI modifier = hostile_status } }
			CHI = { remove_opinion_modifier = { target = PRC modifier = hostile_status } }
		}
	}
}

# Xi'an Incident - Communists Refuse
country_event = {
	id = soviet.22
	title = soviet.22.t
	desc = soviet.22.d
	picture = GFX_report_event_chinese_officers
	
	is_triggered_only = yes
	
	option = {
		name = soviet.22.a
	}
}

# Soviet Union Cedes Land (Japan)
country_event = {
	id = soviet.23
	title = soviet.23.t
	desc = soviet.23.d
	picture = GFX_report_event_soviet_japanese_pact
	
	is_triggered_only = yes
	
	option = {
		name = soviet.23.a
		transfer_state = 655
	}
}

# Great Purge - Begins
country_event = {
	id = soviet.24
	title = soviet.24.t
	desc = soviet.24.d
	picture = GFX_report_event_soviet_purge_speech
	
	is_triggered_only = yes
	
	option = {
		name = soviet.24.a
	}
}

# Demand Bessarabia
country_event = {
	id = soviet.30
	title = soviet.30.t
	desc = soviet.30.d
	picture = GFX_report_event_stalin_propaganda

	is_triggered_only = yes
	
	trigger = {
		tag = SOV
		FROM = { tag = ROM }
		NOT = { has_country_flag = bessarabia_demand }
		78 = {
			is_claimed_by = SOV
			is_owned_by = ROM
		}
	}
	
	immediate = { set_country_flag = bessarabia_demand } 
		
	option = {
		name = soviet.30.a
		ROM = { country_event = { days = 2 id = romania.1 } }
	}
	option = {
		name = soviet.30.b
		ai_chance = { factor = 0 }
		#
	}
}

# Communist government in FROM baltic country and they wish to be annexed
country_event = {
	id = soviet.35
	title = soviet.35.t
	desc = soviet.35.d
	picture = GFX_report_event_soviet_in_riga

	is_triggered_only = yes

	option = {
		name = soviet.35.a
		ai_chance = { factor = 100 }

		effect_tooltip = {
			if = {
				limit = { FROM = { tag = LIT } }
			 	SOV = {
			 		annex_country = {
					target = LIT
					transfer_troops = yes } 
					add_named_threat = { threat = 2 name = soviet.35_threat_LIT }
				}
			}
			if = {
				limit = { FROM = { tag = FIN } } 
			 	SOV = { 
			 		annex_country = {
					target = FIN
					transfer_troops = yes } 
					add_named_threat = { threat = 5 name = soviet.35_threat_FIN }
				}
			}
			if = {
				limit = { FROM = { tag = EST } } 
			 	SOV = { 
			 		annex_country = {
					target = EST
					transfer_troops = yes } 
					add_named_threat = { threat = 2 name = soviet.35_threat_EST }
				}
			}
			if = {
				limit = { FROM = { tag = LAT } } 
			 	SOV = {
			 		annex_country = {
					target = LAT
					transfer_troops = yes } 
					add_named_threat = { threat = 2 name = soviet.35_threat_LAT }
				}
			}
		} 

		hidden_effect = {

			 FROM = {
			 	country_event = { id = baltic.6 hours = 6}
			 }			
		}
	}
	option = {
		name = soviet.35.b
		ai_chance = { factor = 0 }
	}
}

# Communist government in FROM baltic country and they wish to be part puppet
country_event = {
	id = soviet.36
	title = soviet.36.t
	desc = soviet.36.d
	picture = GFX_report_event_soviet_in_riga

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			FROM = {
				save_event_target_as = baltic
			}
		}
	}

	option = {
		name = soviet.36.a
		if = {
			limit = {
				FROM = { is_puppet = no }
			}
			SOV = { puppet = FROM }
		}
		ai_chance = { factor = 100 }
			if = {
				limit = { FROM = { tag = LIT } }
				add_named_threat = { threat = 1 name = soviet.36_threat_LIT }
			}	
			if = {
				limit = { FROM = { tag = FIN } }
				add_named_threat = { threat = 2 name = soviet.36_threat_FIN }
			}			
			if = {
				limit = { FROM = { tag = EST } }
				add_named_threat = { threat = 1 name = soviet.36_threat_EST }
			}			
			if = {
				limit = { FROM = { tag = LAT } }
				add_named_threat = { threat = 1 name = soviet.36_threat_LAT }
			}		

		#trigger news event
		hidden_effect = {
			news_event =  { id = news.70 days = 1}
		}		
	}
	option = {
		name = soviet.36.b
		ai_chance = { factor = 0 }
	}
}

#hidden event to play historic speech
country_event = {
	id = soviet.999
	hidden = yes
	mean_time_to_happen = { days = 2 }
	fire_only_once = yes
	trigger = {
		tag = SOV
		has_war_with = GER
		surrender_progress < 0.5 #let's not tempt fate, it's counter-revolutionary
		has_government = communism
		NOT = {
			has_global_flag = barbarossa_counter
		}
	}
	immediate = {
		play_no_invincible_armies_effect = yes
	}
	option = {}
}

# Polish event for Soviets demanding alignment after Yalta
country_event = {
	id = soviet.70
	title = soviet.70.t
	desc = soviet.70.desc
	picture = GFX_report_event_soviet_tanks

	trigger = {
		tag = POL
		is_subject = no
		NOT = { has_government = communism }
		has_global_flag = yalta_agreed_flag
		SOV = {
			exists = yes
			is_subject = no
		}
		OR = {
			NOT = { GER = { has_government = fascism } }
			GER = { exists = no }
		}
	}
	fire_only_once = yes
	
	option = {
		name = soviet.70.a
		ai_chance = {
			base = 7
		}

		add_timed_idea = {
			idea = communist_influence
			days = 730
		}	

		SOV = {
			country_event = {
				id = soviet.71
				days = 1
			}
		}

	}
	option = {
		name = soviet.70.b
		ai_chance = {
			base = 3
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}

		SOV = {
			country_event = {
				id = soviet.72
				days = 1
			}
		}
		effect_tooltip = {
			SOV = {
				create_wargoal = {
					type = puppet_wargoal_focus
					target = ROOT
				}
			}
		}

	}
}

# Soviet event for Poland joining sphere after Yalta 
country_event = {
	id = soviet.71
	title = soviet.71.t
	desc = soviet.71.desc
	picture = GFX_report_event_soviet_tanks

	is_triggered_only = yes
	fire_only_once = yes
	
	option = {
		name = soviet.71.a
		effect_tooltip = {
			FROM = {
				add_timed_idea = {
					idea = communist_influence
					days = 730
				}	
			}
		}
	}
}

# Soviet event for Poland refusing to join sphere after Yalta 
country_event = {
	id = soviet.72
	title = soviet.72.t
	desc = soviet.72.desc
	picture = GFX_report_event_soviet_tanks

	is_triggered_only = yes
	fire_only_once = yes
	
	option = {
		name = soviet.72.a
		ai_chance = {
			base = 5
			modifier = {
				factor = 0
				POL = {
					is_in_faction_with = USA
				}
			}
		}

		create_wargoal = {
			type = puppet_wargoal_focus
			target = FROM
		}

	}
	option = {
		name = soviet.72.b
		ai_chance = {
			base = 5
		}

		FROM = {
			country_event = {
				id = soviet.73
				days = 7
			}
		}

	}
}

# Polish event for Returning occupied territory
country_event = {
	id = soviet.74
	title = soviet.74.t
	desc = soviet.74.d
	picture = GFX_report_event_SOV_demands
	is_triggered_only = yes 

	trigger = {
		
	}
	#fire_only_once = yes
	
	option = {
		name = soviet.74.a
		ai_chance = {
			base = 1
		}
		POL = {
			add_autonomy_score = { 
				value = -250 
				localization = POL_accepted_states
			}
			add_popularity = {
				ideology = FROM
				popularity = 0.05
			}
		}
		FROM = {
			every_owned_state = {
				limit = {
					is_core_of = POL 
					OR = {
						# Białystok
						state = 97 
						# Uncontested Polish Cores
						NOT = {
							any_country_with_core = {
								NOT = { tag = POL }
							}
						}
					}
					
				}
				transfer_state_to = POL
			}
		}
		FROM = {
			country_event = {
				id = soviet.75
				hours = 2 
				random_hours = 6 
			}
		}
	}
	option = {
		name = soviet.74.b
		ai_chance = {
			base = 0
		}
		POL = {
			add_autonomy_score = { 
				value = 250 
				localization = POL_refused_states
			}
		}
		FROM = {
			every_owned_state = {
				limit = {
					is_core_of = POL 
					OR = {
						# Białystok
						state = 97 
						# Uncontested Polish Cores
						NOT = {
							any_country_with_core = {
								NOT = { tag = POL }
							}
						}
					}
					
				}
				remove_core_of = POL  
				add_core_of = SOV
				add_claim_by = POL 
			}
		}
		FROM = {
			country_event = {
				id = soviet.76
				hours = 2 
				random_hours = 6 
			}
		}
	}
}

# Poland Accepted
country_event = {
	id = soviet.75
	title = soviet.75.t
	desc = soviet.75.d
	picture = GFX_report_event_SOV_demands
	is_triggered_only = yes 
	option = {
		name = soviet.75.a
		ai_chance = {
			base = 1
		}
		add_stability = 0.05
	}
}

# Poland refused
country_event = {
	id = soviet.76
	title = soviet.76.t
	desc = soviet.76.d
	picture = GFX_report_event_SOV_demands
	is_triggered_only = yes 
	option = {
		name = soviet.76.a
		ai_chance = {
			base = 1
		}
	}
}

country_event = {
	id = soviet.504
	title = soviet.504.t
	desc = soviet.504.d
	picture = GFX_report_event_indian_soldiers

	is_triggered_only = yes
	
	option = {
		name = soviet.504.a
		effect_tooltip = {
			SOV = {
				create_wargoal = {
					type = puppet_wargoal_focus
					target = FIN
				}
			}
		}
	}
}


# The successor is now selected. Will depend on the choice of policies and current leader.
# The previous event implies the law on successors is being strictly applied so candidates are not eligible if they have been president before!
country_event = {
	id = soviet.506
	title = soviet.506.t
	desc = soviet.506.d
	
	picture = GFX_report_event_election_vote
	
	is_triggered_only = yes

	# Communist
	
	option = { ##Mao Zedong (Trait:Veteran Communist)
		name = soviet.506.a

		add_country_leader_role = {
			character = KSR_mao_zedong
			country_leader={
				ideology=marxism
				traits={ cornered_fox }
				expire="1965.1.1.1"
				id=-1
			}
			promote_leader = yes
		}
	}
	
	option = { ##Krishna Pillai (Trait: Great Architect)
		name = soviet.506.b

		add_country_leader_role = {
			character = KSR_p_krishna_pillai
			country_leader={
				ideology=marxism
				expire="1965.1.1.1"
				id=-1
				traits = {
					great_architect
				}
			}
			promote_leader = yes
		}
	}

	option = { ##Ilyas Zhansugurov (Trait:Man of the Nation)
		name = soviet.506.c
		
		add_country_leader_role = {
			character = KSR_ilyas_zhansugurov
			country_leader={
				ideology=marxism
				expire="1965.1.1.1"
				id=-1
				traits = {
					face_licker
					revolutionary_poet
				}
			}
			promote_leader = yes
		}
	}
}